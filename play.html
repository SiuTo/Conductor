<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>交响乐指挥</title>
    <link href="./assets/animate.min.css" type="text/css" rel="Stylesheet" />
    <link href="./assets/play.css" type="text/css" rel="Stylesheet" />

</head>
<body>
<div class="container">

<div class="main">
    <div class="pic">
        <img src="assets/images/pic.jpg" width="100%">
    </div>
    <div class="row">
        <div class="icon">
            <div class="m-icon animated fadeInUp infinite" >
                <img src="assets/images/m-icon1.png">
            </div>
            <div class="m-icon2 animated fadeInUp infinite" >
                <img src="assets/images/m-icon2.png">
            </div>
            <img id="guitar" class="infra" src="assets/images/guitar.png">
        </div>
        <div class="icon">
            <img id="drum" class="infra" src="assets/images/drum.png">
        </div>
        <div class="icon">
            <img id="piano" class="infra" src="assets/images/piano.png">
        </div>
    </div>
</div>


</div>
<script src="./assets/js/jquery-1.2.6.js"></script>
<script type="text/javascript" src="howler.js"></script>
<script type="text/javascript" src="myo.js"></script>

<script type="text/javascript">

var piano = new Howl({
  src: ['loop1.wav'],
  loop: true
});

var drum = new Howl({
  src: ['loop2.wav'],
  loop: true
});

var guitar = new Howl({
  src: ['loop3.wav'],
  loop: true
});

var pianoId = piano.play();
var drumId = drum.play();
var guitarId = guitar.play();
piano.volume(0.8,pianoId);
drum.volume(0,drumId);
guitar.volume(0,guitarId);

var isPlayingDrum = false;
var isPlayingGuitar = false;

var current = "P";
$("#piano").addClass("highlight");

var prev={"P":"G","D":"P","G":"D"};
var next={"P":"D","D":"G","G":"P"};
var map={"P":"#piano","D":"#drum","G":"#guitar"};

function updateAudio(gesture){
  if(gesture == 1){
    $(map[current]).removeClass("highlight");
    current = prev[current];
    $(map[current]).addClass("highlight");
  }else if(gesture == 2){
    $(map[current]).removeClass("highlight");
    current = next[current];
    $(map[current]).addClass("highlight");
  }else if(gesture == 3){
    if(current == "D" && !isPlayingDrum){
       drum.seek(0);
      //drum.volume(1,drumId);
       drum.fade(0, 1, 5000, drumId);
       isPlayingDrum = true;
    }else if(current == "G" && !isPlayingGuitar){
        guitar.seek(0);
        //guitar.volume(1,guitarId);
        guitar.fade(0, 1, 5000, guitarId);
        isPlayingGuitar = true;
    }
  }else if(gesture == 4){
      if(current == "D" && isPlayingDrum){
        drum.fade(1, 0, 5000, drumId);
        isPlayingDrum = false;
      }else if(current == "G" && isPlayingGuitar){
          guitar.fade(1, 0, 5000, guitarId);
          isPlayingGuitar = false;
      }
  }else if(gesture == 5){

  }
}

//drum.fade(1, 0, 1000, drumId);
//guitar.rate(1.5, guitarId);
Myo.connect('com.myojs.poseDetector');
//Myo.setLockingPolicy("none");
Myo.on('pose', function(pose){
  $('img.' + pose).attr('src', 'img/' + pose + '_active.png');
  $('.mainPose img').attr('src', 'img/' + pose + '_active.png');
 console.log(pose);
  var gesture;
if (pose == "wave_out")
{
  gesture = 1;
}
if (pose == "wave_in")
{
  gesture = 2;
}
if (pose == "fingers_spread")
{
  gesture = 5;
}
if (pose == "double_tap")
{
  gesture = 3;
}
if (pose == "fist")
{
  gesture = 4;
}
updateAudio(gesture);
  //if (pose == fist)
})

</script>
</body>
</html>